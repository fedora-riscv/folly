From 55f5e4350989f82ceb35c2eda4f8436a02a3fc15 Mon Sep 17 00:00:00 2001
From: Michel Alexandre Salim <michel@michel-slm.name>
Date: Fri, 6 Nov 2020 14:12:09 -0800
Subject: [PATCH] Honor DESTDIR when installing Python extension on Unix
 systems

---
 folly/CMakeLists.txt | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/folly/CMakeLists.txt b/folly/CMakeLists.txt
index 49d12ee82..01c0ead3c 100644
--- a/folly/CMakeLists.txt
+++ b/folly/CMakeLists.txt
@@ -92,9 +92,14 @@ if (PYTHON_EXTENSIONS)
     COMPONENT dev
   )
 
+  # Install Folly Python Bindings
+  if (UNIX)
+    set(ROOT_ARG "--root \$DESTDIR/")
+  endif ()
   # Install Folly Python Bindings
   install(CODE "
     execute_process(COMMAND
-    python3 ${CMAKE_CURRENT_SOURCE_DIR}/python/setup.py install
+    python3 ${CMAKE_CURRENT_SOURCE_DIR}/python/setup.py install --prefix ${CMAKE_INSTALL_PREFIX} ${ROOT_ARG}
+    COMMAND_ECHO STDOUT
     WORKING_DIRECTORY ${_cybld})")
 endif ()
-- 
2.28.0

