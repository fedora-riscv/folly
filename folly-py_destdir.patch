From fc90a3325f2e4c04f9eda9ba95c0edcdc85587fb Mon Sep 17 00:00:00 2001
From: Michel Alexandre Salim <michel@michel-slm.name>
Date: Fri, 6 Nov 2020 14:12:09 -0800
Subject: [PATCH] Honor DESTDIR when installing Python extension on Unix
 systems

---
 folly/CMakeLists.txt | 14 +++++++++++---
 1 file changed, 11 insertions(+), 3 deletions(-)

diff --git a/folly/CMakeLists.txt b/folly/CMakeLists.txt
index 49d12ee82..abd9f42f5 100644
--- a/folly/CMakeLists.txt
+++ b/folly/CMakeLists.txt
@@ -93,8 +93,16 @@ if (PYTHON_EXTENSIONS)
   )
 
   # Install Folly Python Bindings
+  if (UNIX)
+    set(ROOT_ARG "--root \$DESTDIR/")
+  endif ()
   install(CODE "
-    execute_process(COMMAND
-    python3 ${CMAKE_CURRENT_SOURCE_DIR}/python/setup.py install
-    WORKING_DIRECTORY ${_cybld})")
+    execute_process(
+      COMMAND
+      python3 ${CMAKE_CURRENT_SOURCE_DIR}/python/setup.py install
+      --prefix ${CMAKE_INSTALL_PREFIX} ${ROOT_ARG}
+      COMMAND_ECHO STDOUT
+      WORKING_DIRECTORY ${_cybld}
+    )"
+  )
 endif ()
-- 
2.28.0

